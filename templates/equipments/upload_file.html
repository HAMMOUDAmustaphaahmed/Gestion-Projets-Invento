{% extends "base.html" %}

{% block title %}Uploader un fichier - {{ app_name }}{% endblock %}

{% block page_title %}
<i class="bi bi-upload"></i> Uploader un fichier pour {{ equipment.reference }}
{% endblock %}

{% block page_actions %}
<a href="{{ url_for('equipments.view', equipment_id=equipment.id) }}" class="btn btn-outline-secondary">
    <i class="bi bi-arrow-left"></i> Retour
</a>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Uploader un fichier</h5>
    </div>
    <div class="card-body">
        <form method="POST" enctype="multipart/form-data">
            {{ form.hidden_tag() }}
            
            <div class="mb-3">
                {{ form.file.label(class="form-label") }}
                {{ form.file(class="form-control" + (" is-invalid" if form.file.errors else "")) }}
                {% for error in form.file.errors %}
                <div class="invalid-feedback">{{ error }}</div>
                {% endfor %}
                <small class="form-text text-muted">
                    Formats autorisés : PDF, PNG, JPG, JPEG, DOC, DOCX, XLS, XLSX<br>
                    Taille maximale : 10 Mo
                </small>
            </div>
            
            <div class="mb-3">
                {{ form.description.label(class="form-label") }}
                {{ form.description(class="form-control") }}
                <small class="form-text text-muted">Description optionnelle du fichier</small>
            </div>
            
            <div class="d-flex justify-content-between mt-4">
                <a href="{{ url_for('equipments.view', equipment_id=equipment.id) }}" class="btn btn-secondary">
                    <i class="bi bi-x-circle"></i> Annuler
                </a>
                {{ form.submit(class="btn btn-primary") }}
            </div>
        </form>
    </div>
</div>

<div class="card mt-4">
    <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-info-circle"></i> Types de fichiers recommandés</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <h6>Documents techniques</h6>
                <ul>
                    <li>Manuels d'utilisation</li>
                    <li>Schémas électriques</li>
                    <li>Plans d'installation</li>
                    <li>Fiches techniques</li>
                    <li>Certificats de conformité</li>
                </ul>
            </div>
            <div class="col-md-6">
                <h6>Documents administratifs</h6>
                <ul>
                    <li>Factures d'achat</li>
                    <li>Garanties</li>
                    <li>Contrats de maintenance</li>
                    <li>Photos de l'équipement</li>
                    <li>Rapports d'intervention</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('file').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    // Vérifier la taille (10 Mo max)
    if (file.size > 10 * 1024 * 1024) {
        alert('Le fichier est trop volumineux (max 10 Mo)');
        e.target.value = '';
        return;
    }
    
    // Afficher le nom du fichier
    const fileName = document.createElement('div');
    fileName.className = 'alert alert-info mt-2';
    fileName.innerHTML = `
        <i class="bi bi-file-earmark"></i> Fichier sélectionné : ${file.name}<br>
        <small>Taille : ${(file.size / 1024 / 1024).toFixed(2)} Mo</small>
    `;
    
    const existingAlert = document.querySelector('.alert.alert-info.mt-2');
    if (existingAlert) {
        existingAlert.remove();
    }
    
    e.target.parentNode.appendChild(fileName);
});
</script>
{% endblock %}